# WIP-04

## Nostr DID Document Format

`draft` `optional` `proposer: Retric Su (Cryptape)`

This document defines the Web5 DID Document format specific for Nostr protocol. Since Web5 DID is generic, it can be used in different social networks. By default, the DID Document format is compatible with AT Protocol. This document defines the specific key value rules under the Web5 DID Document format to support Nostr specific features.

According to [WIP-01](01.md), the DID Document SHALL use the following fields compatible with did:plc ([DID-PLC]) operation format:

- `verificationMethods` (map): Public key mappings in did:key encoding
- `alsoKnownAs` (array): Alternative identifiers/aliases
- `services` (map): Service endpoint definitions

When users are interacting with Nostr protocol, they need to declare their Nostr metadata in the DID Document format. The DID Document format MUST meet the following rules:

- `verficationMethods` MUST include a key named `nostr` and its value is a public key in lowercase hex string format defined in [NIP-01](https://github.com/nostr-protocol/nips/blob/master/01.md).
- `alsoKnownAs` SHOULD include an nostr:// URI indicating a DNS-based internet identifier for the Nostr account. Note that the identifier MUST be in the format of `bob@example.com` defined in the [NIP-05](https://github.com/nostr-protocol/nips/blob/master/05.md). The URI/DID mapping needs to be validated bi-directionally (via DNS resolution), and needs to be re-verified periodically
- `services` MUST include a key named `nostr_relay` and the value is a websocket service endpoint which the user uses to read and write Nostr events.

## Examples

Nostr-only DID Document:

```json
{
  "verificationMethods": {
    "nostr": "ce6232feaec4e6d01a4e00daa3648030c42017bdf589e34b53744fc49c5cba8a"
  },
  "alsoKnownAs": ["nostr://bob@example.com"],
  "services": {
    "nostr_relay": {
      "type": "NostrRelay",
      "endpoint": "wss://relay.example.com"
    }
  }
}
```

Nostr and AT Protocol DID Document:

```json
{
  "verificationMethods": {
    "atproto": "did:key:zSigningKey",
    "nostr": "ce6232feaec4e6d01a4e00daa3648030c42017bdf589e34b53744fc49c5cba8a"
  },
  "alsoKnownAs": ["at://alice.test", "nostr://alice@example.com"],
  "services": {
    "atproto_pds": {
      "type": "AtprotoPersonalDataServer", 
      "endpoint": "<https://example.test>"
    },
    "nostr_relay": {
      "type": "NostrReplay",
      "endpoint": "wss://relay.example.com"
    }
  }
}
```
